function seleccionarPrimero(){$(".table-productos tbody tr").length>0&&$(".table-productos tbody tr").first().click()}function buscar(){$("#formFiltros").submit();ocultarBody=!0;actualizarOcultarBody(ocultarBody)}function ocultarTbody(){ocultarBody===!1?$("#productosTableBody").hide():ocultarBody===!0&&$("#productosTableBody").show()}function ObtenerMarcasPorRubro(){var n=$("#CodigoRubro").val(),t=$("#CodigoMarca").val();if($("#CodigoRubro").val()!=="")return bloqueadorMarca===!1?($(".cboMarca option").remove(),$.ajax({type:"post",url:baseUrl("/Catalogo/MarcasPorRubro"),dataType:"json",data:{codigoRubro:n},success:function(n){n&&n.length>0&&n.forEach(n=>{var i=t==n.Value?"selected":"",r=`<option value="${n.Value}" ${i}>${n.Text}</option>`;$(".cboMarca").append(r)})}}),!1):void 0}function cargarDatosProducto(n){var t;n.GrupoParametros||(n.Parametros.unshift({Parametro:"Nro. Original",Valor:n.NumeroOriginal||"---"}),n.Parametros.unshift({Parametro:"Cod. Articulo",Valor:n.CodigoPieza}));let i=2,r=[];for(t=0;t<n.Parametros.length;t+=i)r.push(n.Parametros.slice(t,t+i));n.GrupoParametros=r;n.TieneStock=n.Stock>3;var u=$("#template-detalle-producto").html(),f=Handlebars.compile(u),e=f(n);$("#detalle-producto").html(e);n.TieneEquivalencias===!0?$("#detalle-producto .btnEquivalencia").addClass("btn-danger"):($("#detalle-producto .btnEquivalencia").prop("disabled",!n.TieneEquivalencias),$("#detalle-producto .btnEquivalencia").removeClass("btn-danger",!n.TieneEquivalencias))}function cargarStock(n){var t=baseUrl("/Catalogo/ObtenerStock");$.getJSON(t,{codigoPieza:n},function(n){var t=$(".stockDisponible"),i=$(".stockNoDisponible");n.EstadoStock==="EN_STOCK"?(t.removeClass("gris").addClass("verde"),i.removeClass("amarillo").addClass("gris")):n.EstadoStock==="STOCK_MINIMO"&&(t.removeClass("verde").addClass("gris"),i.removeClass("gris").addClass("amarillo"))})}function inicializarKeynavigator(){$("table#tablaProducto > tbody tr").keynavigator({cycle:!1,activeClass:"activo",onAfterActive:function(n){var t=n.data("producto");console.log("fddfsf");(_productoSeleccionado===null||_productoSeleccionado.CodigoPieza!==t.CodigoPieza)&&(_productoSeleccionado=t,cargarDatosProducto(_productoSeleccionado),cargarStock(_productoSeleccionado.CodigoPieza),mostrarPrecio())}})}function inicializarKeynavigatorEquivalencias(){$("table#tablaProducto > #equivalenciasTableBody tr").keynavigator({cycle:!1,activeClass:"activo",onAfterActive:function(n){var t=n.data("producto");(_productoSeleccionado===null||_productoSeleccionado.CodigoPieza!==t.CodigoPieza)&&(_productoSeleccionado=t,cargarDatosProducto(_productoSeleccionado),cargarStock(_productoSeleccionado.CodigoPieza),$(".btnEquivalencia").text("Volver a la Búsqueda"),mostrarPrecio())}})}function cargarPaginaSiguiente(){var n=Number.parseInt($("#Pagina").val())+1,i=updateQueryStringParameter($(".linkPaginacion").val(),"Pagina",n),t=$("#productos-loading");t.show();$.get(i,function(i){var r=document.getElementById("template-filas-productos").innerHTML,u=Handlebars.compile(r),f=u({productos:i.Data.Productos,equivalencia:!1});$("#ultimaPagina").val(i.Data.UltimaPagina);$("table.table-productos tbody").append(f);$("#Pagina").val(n);_cargarPagina=!0;t.hide();inicializarKeynavigator()})}function obtenerProductoEquivalentes(){_productoEquivalencia&&$.get(baseUrl("Catalogo/Equivalencias"),{codigoPieza:_productoEquivalencia.CodigoPieza},function(n){var i,t;n.unshift(_productoEquivalencia);var r=document.getElementById("template-filas-productos").innerHTML,u=Handlebars.compile(r),f=u({productos:n,equivalencia:!0}),e=$("#equivalenciasTableBody");e.html(f);$("#productosTableBody").hide();$("#equivalenciasTableBody").show();inicializarKeynavigatorEquivalencias();i=$(".table-productos #equivalenciasTableBody");t=i.find("tr:first");t.after('<tr class="filaEquivalencia"><td>&nbsp;<\/td><td colspan="5"><i class="icon-down-1"><\/i>EQUIVALENCIAS<i class="icon-down-1"><\/i><\/td><\/tr>');t.addClass("activo").click()})}function hayPaginaSiguiente(){return $("#ultimaPagina").val()==="false"}function configurarCandado(){bloqueadorMarca===!0?($("#candado").removeClass("icon-lock-open"),$("#candado").addClass("icon-lock")):($("#candado").addClass("icon-lock-open"),$("#candado").removeClass("icon-lock"));bloqueadorTipoAuto===!0?($("#candadoTipo").removeClass("icon-lock-open"),$("#candadoTipo").addClass("icon-lock")):($("#candadoTipo").addClass("icon-lock-open"),$("#candadoTipo").removeClass("icon-lock"))}function mostrarPrecioVenta(){var n=_productoSeleccionado.PrecioVigente,t=_calculadora.calcularPrecio(n);$("#icono").removeClass("icon-money");$("#icono").addClass("icon-tag-1");$("#txtPrec").html("Precio Venta: ");$(".btnCambiar").attr("title","Ver costo neto s/IVA");$(".txtPrecioProducto").val("$ "+formatNumber(t))}function mostrarCostoNeto(){var n=_productoSeleccionado.PrecioVigente,t=_calculadora.calcularPrecioNeto(n);$("#icono").removeClass("icon-tag-1");$("#icono").addClass("icon-money");$("#txtPrec").html("Costo Neto s/IVA: ");$(".btnCambiar").attr("title","Ver precio de venta");$(".txtPrecioProducto").val("$ "+formatNumber(t))}function actualizarIndicadorPrecio(){_precio===!0?(mostrarCostoNeto(),_precio=!1):(mostrarPrecioVenta(),_precio=!0)}function mostrarPrecio(){_precio===!0?mostrarPrecioVenta():mostrarCostoNeto()}var _cargarPagina=!0,_productoSeleccionado=null,_productoEquivalencia=null,_calculadora=new CalculadoraPrecio,_precio=!0,bloqueadorMarca=!1,bloqueadorTipoAuto=!1,ocultarBody=!1;$(document).ready(function(){var n,t,i;helperJson();helperPrecio();ObtenerMarcasPorRubro();n=obtenerCandado();bloqueadorMarca=n.marca;bloqueadorTipoAuto=n.tipo;t=obtenerOcultarBody();ocultarBody=t.ocultar;ocultarTbody();configurarCandado();Handlebars.registerHelper("formatOferta",function(n){return n.TieneOferta?"oferta":""});$(document).keydown(function(n){var t=$(".contenedor-tabla-productos").scrollTop();switch(n.which){case 38:$(".contenedor-tabla-productos").scrollTop(t-25);break;case 39:break;case 40:$(".contenedor-tabla-productos").scrollTop(t+25);break;default:return}});inicializarKeynavigator();seleccionarPrimero();$("#detalle-producto").on("click",".btnCambiar",function(){actualizarIndicadorPrecio()});$("#formFiltros").on("click",".btnBloquearMarca",function(){bloqueadorMarca===!1?(bloqueadorMarca=!0,$("#candado").removeClass("icon-lock-open"),$("#candado").addClass("icon-lock"),actualizarCandados(bloqueadorMarca,bloqueadorTipoAuto)):bloqueadorMarca===!0&&(bloqueadorMarca=!1,$("#candado").addClass("icon-lock-open"),$("#candado").removeClass("icon-lock"),actualizarCandados(bloqueadorMarca,bloqueadorTipoAuto))});$("#formFiltros").on("click",".btnBloquearTipoAuto",function(){bloqueadorTipoAuto===!1?(bloqueadorTipoAuto=!0,$("#candadoTipo").removeClass("icon-lock-open"),$("#candadoTipo").addClass("icon-lock"),actualizarCandados(bloqueadorMarca,bloqueadorTipoAuto)):bloqueadorTipoAuto===!0&&(bloqueadorTipoAuto=!1,$("#candadoTipo").addClass("icon-lock-open"),$("#candadoTipo").removeClass("icon-lock"),actualizarCandados(bloqueadorMarca,bloqueadorTipoAuto))});$(".target").change(function(){bloqueadorMarca===!1&&$.ajax({data:data,url:baseUrl("Catalogo/Index"),type:"post",beforeSend:function(){}}).done(function(){typeof callback=="function"&&callback()})});$("#formFiltros").on("click",".btnBusca",function(){buscar()});$(".txtProducto").keypress(function(n){n.which===13&&(ocultarBody=!0,actualizarOcultarBody(ocultarBody))});$("#CodigoRubro").change(function(){ObtenerMarcasPorRubro()});$(".cboMarca").change(function(){var n=$(".cboMarca").val();let t=baseUrl("/Catalogo/TipoAutoPorMarca");if(bloqueadorTipoAuto===!1)return $(".cboTipo option").remove(),$.ajax({type:"POST",url:t,dataType:"json",data:{codigoMarca:n}}).done(function(){$.each(states,function(n,t){$(".cboTipo").append("<option value="+t.Value+">"+t.Text+"<\/option>")})}),!1});$(".cboFiltros").on("change",function(){buscar()});$("#detalle-producto").on("click",".img-producto",function(){let n=$(this),r=n.attr("src"),u=n.attr("alt");var t=$("#modal-imagen-producto"),i=t.find("img");i.attr("src",r);i.attr("alt",u);t.fadeIn()});$(".cerrar").click(function(){$(".modal").fadeOut(300)});$("#detalle-producto").on("click",".btnAgregarCarrito",function(){var n=$(".txtCantidadCarrito").val(),t=$(this).data("unidadVenta");if(isNaN(n)||n<1){notificarWarning("Error: Ingrese una cantidad válida");return}agregarAlCarrito(n,_productoSeleccionado.CodigoPieza,!0,t,function(){notificarSuccess("Producto agregado al carrito")})});$("#detalle-producto").on("click",".btnEquivalencia",function(){_productoEquivalencia?($(".btnEquivalencia").text("Ver Equivalencias"),$("#equivalenciasTableBody").hide(),$("#productosTableBody").show(),_productoSeleccionado=_productoEquivalencia,_productoEquivalencia=null,mostrarPrecio()):($(".btnEquivalencia").text("Volver a la Búsqueda"),_productoEquivalencia=_productoSeleccionado,obtenerProductoEquivalentes())});i=$("table.headerFixed");i.floatThead({scrollContainer:function(n){return n.closest(".wrapper")}});$(".contenedor-tabla-productos").on("scroll",function(){if(!_productoEquivalencia){var n=$(".contenedor-tabla-productos")[0],t=n.scrollTop,i=n.scrollHeight;i-t+200<470&&_cargarPagina&&hayPaginaSiguiente()&&(cargarPaginaSiguiente(),_cargarPagina=!1)}})});